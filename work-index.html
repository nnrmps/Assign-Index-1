<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <ul id="Data"></ul>
    <ul id="employee"></ul>
    <script>
        
         
        
        //1. Swap & Replace
        var name = ["Bow", "peam", "bilfer", "yoyo"];
        var name1 = ["Bow", "peam", "bilfer", "yoyo"];
        function swap(input,index_A,index_B){
            var temp = input[index_A];

            input[index_A] = input[index_B];
            input[index_B] = temp;
        }
        function replace(input,index_A,index_B){
            

            input[index_A] = input[index_B];
            
        }
        replace(name1,0,1);
        swap(name,1,3);
        console.log("Replace: "+name1);
        console.log("Swap: "+name);
        
        var WorkClone;
        var DetailClone ;       
        var xhttp = new XMLHttpRequest();     
        xhttp.onreadystatechange = function() {
            if (this.readyState == 4 && this.status == 200) {
                var response1 = JSON.parse(xhttp.responseText);
                WorkClone = response1;
                //2.1
                AverageWorkingTime(response1);
                var xhttp2 = new XMLHttpRequest();     
                xhttp2.onreadystatechange = function() {
                    if (this.readyState == 3 && this.status == 200) {
                        var res2 = JSON.parse(xhttp2.responseText);
                        DetailClone = res2;
                        //2.2
                        AverageStartTimeAsOfficer(res2,WorkClone);
                        //2.3
                        MostWorkingTime(res2,WorkClone)
                        //2.4
                        Came_Late(res2,WorkClone)
                        }
                };
                xhttp2.open("GET", "employee-detail.json", true);
                xhttp2.send();
            }
        };
        xhttp.open("GET", "work-weekly.json", true);
        xhttp.send();
       
        function AverageWorkingTime(response1) {
            var sum_hh = 0;
            var sum_mm = 0;
            var sum_ss = 0;
            //2.1 Average working time
            for (var i = 0; i< response1.Data.length;i++){
                    var End = response1.Data[i].endTime.split(' ');
                    var Start = response1.Data[i].startTime.split(' ');
                    var End2 = End[1].split(':');
                    var Start2 = Start[1].split(':');
                    var hh = (End2[0]-12) +(12- Start2[0]);
                    var mm1 = parseInt(End2[1]);
                    var mm2 = Start2[1]-60;
                    if (mm2 < 0){
                        hh = hh-1;
                        mm1 = mm1 + Math.abs(mm2);
                        if (mm1 > 59){
                            hh = hh+1;
                            mm1 = mm1-60;
                        }
                    }
                    var ss = Math.abs(End2[2] -Start2[2]);
                    sum_hh = sum_hh + hh;
                    sum_mm = sum_mm + mm1;
                    sum_ss = sum_ss + ss;
                }
                sum_hh = sum_hh/response1.Data.length;
                sum_mm = sum_mm/response1.Data.length;
                var co = sum_mm;
                sum_ss = sum_ss/response1.Data.length;
                var n = Math.abs(sum_hh.toFixed() - sum_hh) * 60;
                if (sum_hh.toFixed() > sum_hh.toFixed(1)){
                    sum_mm = sum_mm - n;
                    if (sum_mm < 0){
                        sum_hh = sum_hh -1;
                        co = co + n;
                        sum_mm = co;
                    }
                }
                else if (sum_hh.toFixed() < sum_hh.toFixed(2)){
                    sum_mm = sum_mm + n;
                }
                console.log("2.1 Average working time of all employee this week = " + sum_hh.toFixed() + ":" + sum_mm.toFixed() + ":" + sum_ss.toFixed() + " ");
        }
        function AverageStartTimeAsOfficer(detailclone,workclone) {
            var sumhh = 0;
            var summm = 0;
            var sumss = 0;
            var count = 0;
            for (var i = 0; i< detailclone.employee.length;i++){
                if (detailclone.employee[i].position == "officer"){
                    for (var j = 0; j< WorkClone.Data.length;j++){
                        if(detailclone.employee[i].employeeId == WorkClone.Data[j].employeeId){
                            var Start = WorkClone.Data[j].startTime.split(' ');
                            var Start2 = Start[1].split(':');
                            sumhh = sumhh + parseInt(Start2[0]);
                            summm = summm + parseInt(Start2[1]);
                            sumss = sumss + parseInt(Start2[2]);
                            count = count + 1;
                        }
                    }
                }
            }
            var n = 0;
            sumhh = sumhh/count;
            summm = summm/count;
            sumss = sumss/count;
            n = Math.abs(sumhh.toFixed() - sumhh) * 60;
            if (sumhh.toFixed() > sumhh.toFixed(2)){
                summm = Math.abs(summm - n);
            }
            else if (sumhh.toFixed() < sumhh.toFixed(2)){
                summm = summm + n;
            }
            console.log("2.2 Average startTime for employee that has 'officer' as position this week = " + (sumhh).toFixed() + ":" + (summm).toFixed() + ":" + (sumss).toFixed() + " ");
        }
    
        function MostWorkingTime(detailclone,workclone) {
            var WorkerID = []
            var sum_diff_time = []
            var count = 0;
            var sum_hh = 0;
            var sum_mm = 0;
            var sum_ss = 0;
            var c= 0;
            var max = [];
            var remember = 0;
            for (var i = 0; i < detailclone.employee.length;i++){
                sum_hh = 0;
                sum_mm = 0;
                sum_ss = 0;
                c =0;
                for (var j = 0; j < workclone.Data.length;j++) {
                    if (detailclone.employee[i].employeeId == workclone.Data[j].employee){
                        var End = workclone.Data[j].endTime.split(' ');
                        var Start = workclone.Data[j].startTime.split(' ');
                        var End2 = End[1].split(':');
                        var Start2 = Start[1].split(':');
                        var hh = (End2[0]-12) +(12- Start2[0]);
                        var mm1 = parseInt(End2[1]);
                        var mm2 = Start2[1]-60;
                        if (mm2 < 0){
                            hh = hh-1;
                            mm1 = mm1 + Math.abs(mm2);
                            if (mm1 > 59){
                                hh = hh+1;
                                mm1 = mm1-60;
                            }
                        }
                        var ss = Math.abs(End2[2] -Start2[2]);
                        sum_hh = sum_hh + hh;
                        sum_mm = sum_mm + mm1;
                        sum_ss = sum_ss + ss;
                        c = c+1;                   
                    }
                }        
                sum_hh = sum_hh/c;
                sum_mm = sum_mm/c;
                sum_ss = sum_ss/c;
                var n = Math.abs(sum_hh.toFixed() - sum_hh) * 60;
                if (sum_hh.toFixed() > sum_hh.toFixed(2)){
                    sum_mm = Math.abs(sum_mm - n);
                }
                else if (sum_hh.toFixed() < sum_hh.toFixed(2)){
                    sum_mm = sum_mm + n;
                }
                sum_diff_time[i] = (sum_hh.toFixed() + ":" + sum_mm.toFixed()+ ":" + sum_ss.toFixed())
                if (i == 0){
                    max[0] = sum_hh.toFixed()
                    max[1] = sum_mm.toFixed()
                    max[2] = sum_ss.toFixed()
                    remember = i;
                }
                else{
                    if (max[0] < sum_hh.toFixed()){
                        max[0] = sum_hh.toFixed()
                        remember = i;
                        console.log(max[0]);
                    }
                    else{
                        if (max[1] < sum_mm.toFixed()){
                            max[1] = sum_mm.toFixed()
                            remember = i;
                            console.log(max[1]);
                        }
                        else if (max[1] == sum_mm.toFixed()) {
                            if (max[2] < sum_ss.toFixed()){
                                max[2] = sum_ss.toFixed()
                                remember = i;
                                console.log(max[2]);
                            }
                        }
                    }
                }       
            }
            console.log("2.3 most working time this week : " + detailclone.employee[remember].employeeId 
            + " " + detailclone.employee[remember].firstname + " " + detailclone.employee[remember].lastname 
            + " , " + detailclone.employee[remember].position + ", Working time is ==> "+sum_diff_time[remember])
            
        }
        var output = []
        function Came_Late(detailclone,workclone) {
            var index =0;
            var index2 =0;
            for (var i = 0; i < detailclone.employee.length;i++){
                index2 = 0;
                for (var j = 0; j < workclone.Data.length;j++) {
                    
                    if (detailclone.employee[i].employeeId == workclone.Data[j].employeeId){
                        var Start = workclone.Data[j].startTime.split(' ');
                        var Start2 = Start[1].split(':');
                        if (8 <= Start2[0]){
                            if (30 < Start2[1]){
                                if (index2 == 0){
                                    output.push(
                                        {
                                        employeeId: detailclone.employee[i].employeeId,
                                        firstname: detailclone.employee[i].firstname,
                                        lastname: detailclone.employee[i].lastname,
                                        position: detailclone.employee[i].position,
                                        dateTime: [                                      
                                        ]
                                    })   
                                    index2 = 1;
                                }                             
                                var lateHr = 0;
                                var lateMM = 0;
                                var total_late_time = 0;
                                if ( 8 <= Start2[0]){
                                    lateHr = (Start2[0] - 8) * 60;
                                    if (30 < Start2[1]) {
                                        lateMM = (Start2[1] - 30)
                                    }
                                }
                               
                                total_late_time = lateHr + lateMM;
                                output[index].dateTime.splice(1, 0, {
                                                date: Start[0],
                                                time: Start2[0] + ":" + Start2[1],
                                                lateMinutes: total_late_time
                                            }   );
                            }
                        }
                    }
                }
            }
            console.log(output)
            
        }
    </script>
    <button onclick="MostWorkingTime()">Try it</button>
        

</body>
</html>

